/**
* Cores Na Prateleira
* @author Carlos Vinicius
* @version 5.0
* @date 2011-10-10
*/
"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});
jQuery.fn.coresPrateleira=function(s){var r,a,n,p,q;r=jQuery("");q=-1<document.location.href.toLowerCase().indexOf("debugcp");n=function(b,a){"object"==typeof console&&console.log("[Cores Prateleira - "+(a||"Erro")+"] "+b)};p=function(b,a){"object"==typeof console&&q&&console.log("[debug][Cores Prateleira - "+(a||"Erro")+"] "+b)};a={loadSkuJqxhr:null,productOriginalInfo:null,productOriginalLink:null,productOriginalSave:null,saveCount:0,onHover:!1,skuList:[],skuQueue:[],productShelf:null,skuGroup:{},
options:{productsLi:">ul li",ajaxCallback:function(){},callback:function(){},messageRequestFail:"N\u00e3o foi posss\u00edvel obter as informa\u00e7\u00f5es deste item.",saveText:"Economize: R$ #value",speedFade:200,thumbsQuantity:4,currency:"R$ ",restoreOriginalDetails:!1,checkLinkEquals:!1,forceAvailable:!1,forceImgList:!1,autoSetup:!0,checkIsAvaliable:!1,minSkuQttShow:2,productImgId:30,thumbImgId:3,action:2},init:function(b){jQuery.extend(a.options,b);a.createSkuElementsList();a.options.callback()},
createSkuElementsList:function(){var b=a.productShelf;0<b.length&&b.each(function(b){var c=jQuery(this);c.hasClass("vtex-cpIsActivated")||(v=a.exec(c,b))})},exec:function(b,d){var c=b.find(a.options.productsLi);if(1>c.length)return n("Prateleira n\u00e3o encontrada \n ("+c.selector+")"),!1;b.addClass("vtex-cpIsActivated");c.each(function(b){var c,f,i,h;c=jQuery(this);!0===a.options.autoSetup&&a.shelfSetup(c);f=c.find(".vtex-cpSkuList");i=c.find(".vtex-cpProductField");h=i.find("li").text().trim().split("|");
q&&""==i.find("li").text().trim()&&p("O campo produto n\u00e3o esta retornando nenhum valor.\n Produto: "+(c.find(".vtex-cpProductLink[title]:first").attr("title")||"[T\u00edtulo n\u00e3o encontrado]"),"Aviso");b=d.toString()+"_"+b.toString();h=a.groupSku(h,b);c.find(".vtex-cpProductImage img").addClass("vtex-cpOriginalImage");skuArrayLength=h.length;(a.options.forceAvailable||a.options.forceImgList)&&f.addClass("vtex-cpShow").removeClass("vtex-cpHide");if(skuArrayLength>=a.options.minSkuQttShow)for(var j=
0;j<skuArrayLength;j++){var l,k;l=h[j][1];k=h[j][0].trim();if(a.options.checkLinkEquals&&(i=k.replace(/http\:\/\/[a-z-\.]+(?=\/)/i,"")==(c.find(".vtex-cpProductLink:first").attr("href")||"").trim().replace(/http\:\/\/[a-z-\.]+(?=\/)/i,""))){p("O sku \u201c"+l+"\u201d foi ignorado pois tem o mesmo link que o produto existente na vitrine.\n URI: "+k.trim().replace(/http\:\/\/[a-z-\.]+(?=\/)/i,""),"Aviso");continue}if(j>=a.options.thumbsQuantity){c.find(".vtex-cpViewMore").addClass("vtex-cpShow").removeClass("vtex-cpHide");
break}else""!=l&&(skuArrayLength>a.options.thumbsQuantity&&j>=a.options.thumbsQuantity-1||f.append(a.setThumbs(c,l,jQuery("<span class='vtex-cpSkuIds vtex-cpIndex_"+j+" vtex-cpSkuId_"+l+(0==j?" vtex-cpFirst":"")+"'><span class='vtex-cpInner'></span><span class='vtex-cpInner2'></span></span>"),k,b)))}})},groupSku:function(b,d){var c={},e={},g=[],f,i,h;h=b.length;if(2>h&&""==b[0])return g;for(var j=0;j<h;j++)f=b[j].split(";"),i=f.pop(),f=f.shift(),"undefined"!=typeof i&&("undefined"==typeof c[f]?c[f]=
[i]:c[f].push(i));for(ndx in c){h=c[ndx].length;i=[];if(3<h){f=parseInt(h/3);for(var l=h%3,k=2*f,j=0;j<f;j++)i.push(c[ndx][j]),i.push(c[ndx][j+f]),i.push(c[ndx][j+k]);1==l?i.push(c[ndx][h-1]):2==l&&(i.push(c[ndx][h-1]),i.push(c[ndx][h-2]))}else i=c[ndx];g.push([i.shift(),ndx]);e[ndx]=i}a.skuGroup[d]=e;return g},setThumbs:function(b,d,c,e,g){var f=b.find(".vtex-cpOverlay");c.addClass("vtex-cpLoadingData");a.loadSku(b,d,f,a.options.action,c,e,g);return c},checkIsAvaliable:function(b,d,c,e,g,f){if(e[0].Availability||
!a.options.checkIsAvaliable)a.mouseActions2(b,d,c,e,g);else{var i=b.find(".vtex-cpOverlay");"undefined"!=typeof a.skuGroup[f][g]&&0<a.skuGroup[f][g].length?a.loadSku(b,a.skuGroup[f][g].shift(),i,a.options.action,c,g,f):a.mouseActions2(b,d,c,e,g)}},mouseActions2:function(b,d,c,e,g){a.setImgThumb(c,e);a.setClass(c,e);c.bind({mouseenter:function(){b.find(".vtex_cpActiveSku").removeClass("vtex_cpActiveSku");c.addClass("vtex_cpActiveSku");a.productOriginalInfo=b.find(".vtex-cpProductInfoWrap").children().clone();
a.productOriginalLink=b.find(".vtex-cpProductLink:first").attr("href")||"";var d=b.find(".vtex-cpSave");a.productOriginalSave=[d.html()||"",d.attr("class")||""];a.formatInfo(e,b,g);a.onHover=!0}});a.options.restoreOriginalDetails&&c.bind({mouseleave:function(){b.find(".vtex_cpActiveSku").removeClass("vtex_cpActiveSku");a.setOriginalElements(b);a.onHover=!1}});return c},mouseActions:function(b,d,c){c.bind({mouseenter:function(){b.find(".vtex_cpActiveSku").removeClass("vtex_cpActiveSku");c.addClass("vtex_cpActiveSku");
var e=b.find(".vtex-cpOverlay").show();a.loadSku(b,d,e);a.productOriginalInfo=b.find(".vtex-cpProductInfoWrap").children().clone();a.onHover=!0},mouseleave:function(){b.find(".vtex_cpActiveSku").removeClass("vtex_cpActiveSku");b.find(".vtex-cpOverlay").hide();a.loadSkuJqxhr.abort();a.setOriginalElements(b);a.onHover=!1}});return c},formatInfo:function(b,d,c){d.addClass("vtex-cpInfoFromSKU");var e=b[0];if(e.Availability||a.options.forceAvailable)if(b=d.find(".vtex-cpProductInfo"),b.addClass("vtex-cpShow").removeClass("vtex-cpHide"),
d.find(".vtex-cpProductUnavailable").addClass("vtex-cpHide").removeClass("vtex-cpShow"),b.find(".vtex-cpBestPrice").text(a.options.currency+a.numberFormat(e.Price)),d.find(".vtex-cpSave").html(a.options.saveText.replace("#value",a.numberFormat(e.ListPrice-e.Price))),e.Price<e.ListPrice?(b.find(".vtex-cpListPriceWrap").addClass("vtex-cpShow").removeClass("vtex-cpHide").find(".vtex-cpListPrice").text(a.options.currency+a.numberFormat(e.ListPrice)),d.find(".vtex-cpSave").addClass("vtex-cpShow").removeClass("vtex-cpHide")):
(b.find(".vtex-cpListPriceWrap").addClass("vtex-cpHide").removeClass("vtex-cpShow"),d.find(".vtex-cpSave").addClass("vtex-cpHide").removeClass("vtex-cpShow")),1<e.BestInstallmentNumber){var g=b.find(".vtex-cpInstallment").addClass("vtex-cpShow").removeClass("vtex-cpHide");g.find(".vtex-cpNumbersOfInstallment").text(e.BestInstallmentNumber);g.find(".vtex-cpInstallmentValue").text(a.options.currency+a.numberFormat(e.BestInstallmentValue));b.find(".vtex-cpFullRegularPrice").addClass("vtex-cpHide").removeClass("vtex-cpShow")}else b.find(".vtex-cpInstallment").addClass("vtex-cpHide").removeClass("vtex-cpShow"),
b.find(".vtex-cpFullRegularPrice").addClass("vtex-cpShow").removeClass("vtex-cpHide");else d.find(".vtex-cpProductInfo").addClass("vtex-cpHide").removeClass("vtex-cpShow"),d.find(".vtex-cpProductUnavailable").addClass("vtex-cpShow").removeClass("vtex-cpHide");var b=d.find(".vtex-cpProductImage"),f=d.find(".vtex-cpImgOverlay"),i=b.find(".vtex-cpOriginalImage"),h=i[0],j=i.clone(),g=j.attr("width")||h.naturalWidth,h=j.attr("height")||h.naturalHeight,e=a.getImageUrl(e,a.options.productImgId),j=d.find("img[src*='"+
(e[0]||i.attr("src"))+"']"),l=0<j.length?!0:!1,k=jQuery('<img src="'+(e[0]||i.attr("src"))+'" alt="" '+("undefined"!==typeof g?'width="'+g+'"':"")+" "+("undefined"!==typeof h?'height="'+h+'"':"")+' class="vtex-cpSkuImage" style="display:none;" />');""!=c&&d.find(".vtex-cpProductLink").attr("href",c.replace(/http\:\/\/[a-z-\.]+(?=\/)/i,""));f.show();l?(i.stop(!0).fadeOut(a.options.speedFade),f.hide(),d.find(".vtex-cpSkuImage").stop(!0).fadeOut(a.options.speedFade),j.stop(!0).fadeTo(a.options.speedFade,
1)):(k.load(function(){a.onHover?(i.stop(!0).fadeOut(a.options.speedFade),f.hide(),d.find(".vtex-cpSkuImage").stop(!0).fadeOut(a.options.speedFade),k.stop(!0).fadeTo(a.options.speedFade,1)):(f.hide(),a.setOriginalImg(d))}),b.append(k))},setOriginalElements:function(b){null!=a.productOriginalInfo&&b.hasClass("vtex-cpInfoFromSKU")&&(b.removeClass("vtex-cpInfoFromSKU").find(".vtex-cpProductInfoWrap").html(a.productOriginalInfo),a.setOriginalImg(b),a.setOriginalLink(b),a.setOriginalSaveText(b))},setOriginalImg:function(b){b=
b.find(".vtex-cpProductImage");b.find(":not(.vtex-cpOriginalImage)").stop(!0).fadeOut(a.options.speedFade);b.find(".vtex-cpOriginalImage").stop(!0).fadeTo(a.options.speedFade,1)},setOriginalLink:function(b){b.find(".vtex-cpProductLink").attr("href",a.productOriginalLink)},setOriginalSaveText:function(b){b.find(".vtex-cpSave").html(a.productOriginalSave[0]).attr("class",a.productOriginalSave[1])},setImgThumb:function(b,d){var c=a.getImageUrl(d[0],a.options.thumbImgId);b.removeClass("vtex-cpLoadingData");
0<c.length&&(b.css("background-image","url('"+c[0]+"')"),b.find(".vtex-cpInner").append('<img src="'+c[0]+'" alt="" class="vtex-cpImgsThumb vtex-cpThumb_'+d[0].Id+'" alt=""/>'))},loadSku:function(b,d,c,e,g,f,i){var e=e||1,g=g||r,d=d.toString().trim(),h=d.toString();"undefined"!==typeof a.skuQueue[h]?a.skuQueue[h].push({liElem:b,skuId:d,span:g,link:f}):(a.skuQueue[h]=[],a.loadSkuJqxhr=jQuery.ajax({url:"/produto/sku/"+d,data:"json",success:function(c,l,k){if("object"!==typeof c)return n(a.options.messageRequestFail+
"\n skuId: "+d+"\n(textStatus:'"+l+"', jqXHR:'"+k+"')"),g.hide(),!1;if(0!=k.status){a.skuQueue[h].push({liElem:b,skuId:d,span:g,link:f});for(var l=a.skuQueue[h].length,k=a.skuQueue[h],m=0;m<l;m++)switch(e){case 1:a.formatInfo(c,k[m].liElem);break;case 2:a.checkIsAvaliable(k[m].liElem,k[m].skuId,k[m].span,c,k[m].link,i)}a.skuQueue[h]=void 0;a.options.ajaxCallback()}},error:function(b,c,e){n(a.options.messageRequestFail+"\n skuId: "+d+"\n(textStatus:'"+c+"', jqXHR:'"+b+"', errorThrown:'"+e+"')");g.hide()}}))},
numberFormat:function(b){for(var a="",c=a="",b=b.toFixed(2).split("."),e=0,g=b[0].split("").length,f=b[0].length;0<f;f--)a=b[0].substr(f-1,1),e++,0==e%3&&g>e&&(a="."+a),c=a+c;return a=c+","+b[1]},getImageUrl:function(b,a){var c=[];if(1>b.Images.length)return n("N\u00e3o foram encontradas imagens para o SKU: "+b.Id),c;for(array in b.Images)for(img in b.Images[array])if(b.Images[array][img].ArchiveTypeId==a){c.push(b.Images[array][img].Path);break}return c},setClass:function(b,a){var c=a[0].Name.replace(/[^a-zA-Z0-9\-\_]/g,
"");b.addClass("vtex-cp_"+c)},shelfSetup:function(b){b.find("a[href='"+b.find(".vtex-cpUri").val()+"']").addClass("vtex-cpProductLink");var d=null;b.find("img").each(function(){var a=jQuery(this);d=null===d?a:d;if(0<(a.attr("width")||0))d=a});d.before('<div class="vtex-cpImgOverlay"></div>');d.parent().addClass("vtex-cpProductImage");var c=jQuery('<span class="vtex-cpProductTextWrap"><div class="vtex-cpOverlay"></div></span>'),e=jQuery('<span class="vtex-cpProductInfoWrap"></span>'),g=b.find(".vtex-cpProductInfo");
g.before(c);g.appendTo(e);b.find(".vtex-cpProductUnavailable").appendTo(e);e.appendTo(c);1>a.saveCount&&(c=/\sR\$\s[0-9]+,[0-9]{1,2}/i,b=b.find(".vtex-cpSave").text(),-1<b.search(c)&&(a.options.saveText=b.replace(c," R$ #value")),a.saveCount++)}};a.productShelf=jQuery(this);a.init(s);return a.productShelf};