/**
* Cores Na Prateleira
* @author Carlos Vinicius
* @version 5.0
* @date 2011-10-10
*/
"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});
jQuery.fn.coresPrateleira=function(s){var q,b,n,r,p;q=jQuery("");p=-1<document.location.href.toLowerCase().indexOf("debugcp");n=function(a,b){"object"==typeof console&&console.log("[Cores Prateleira - "+(b||"Erro")+"] "+a)};r=function(a,b){"object"==typeof console&&p&&console.log("[debug][Cores Prateleira - "+(b||"Erro")+"] "+a)};b={loadSkuJqxhr:null,productOriginalInfo:null,productOriginalLink:null,productOriginalSave:null,saveCount:0,onHover:!1,skuList:[],skuQueue:[],productShelf:null,skuGroup:{},
options:{productsLi:">ul li",ajaxCallback:function(){},initCallback:function(){},messageRequestFail:"N\u00e3o foi posss\u00edvel obter as informa\u00e7\u00f5es deste item.",saveText:"Economize: R$ #value",speedFade:200,thumbsQuantity:4,currency:"R$ ",restoreOriginalDetails:!1,checkLinkEquals:!0,linkAdjust:function(a){return-1<document.location.href.indexOf(".vtexcommerce")?a:a.replace(".vtexcommerce","").replace(/:\/\/(?!www)|:\/\/(?!www)/i,"://www.")},forceAvailable:!1,forceImgList:!1,autoSetup:!0,
minSkuQttShow:2,productImgId:30,thumbImgId:3,action:2},init:function(a){jQuery.extend(b.options,a);b.createSkuElementsList();b.options.initCallback()},createSkuElementsList:function(){var a=b.productShelf;0<a.length&&a.each(function(a){var c=jQuery(this);c.hasClass("vtex-cpIsActivated")||(v=b.exec(c,a))})},exec:function(a,d){var c=a.find(b.options.productsLi);if(1>c.length)return n("Prateleira na encontrada \n ("+c.selector+")"),!1;a.addClass("vtex-cpIsActivated");c.each(function(a){var c,g,f,i;c=
jQuery(this);!0===b.options.autoSetup&&b.shelfSetup(c);g=c.find(".vtex-cpSkuList");f=c.find(".vtex-cpProductField");i=f.find("li").text().trim().split("|");p&&""==f.find("li").text().trim()&&r("O campo produto n\u00e3o esta retornando nenhum valor.\n Produto: "+(c.find(".vtex-cpProductLink[title]:first").attr("title")||"[T\u00edtulo n\u00e3o encontrado]"),"Aviso");a=d.toString()+"_"+a.toString();i=b.groupSku(i,a);c.find(".vtex-cpProductImage img").addClass("vtex-cpOriginalImage");skuArrayLength=i.length;
f=b.options.linkAdjust(i[0][0]).trim().replace(/http\:\/\/[a-z-\.]+(?=\/)/i,"")==(c.find(".vtex-cpProductLink:first").attr("href")||"").trim().replace(/http\:\/\/[a-z-\.]+(?=\/)/i,"");(b.options.forceAvailable||b.options.forceImgList)&&g.addClass("vtex-cpShow").removeClass("vtex-cpHide");if(skuArrayLength>b.options.minSkuQttShow-1&&(b.options.checkLinkEquals?!f:1))for(f=0;f<skuArrayLength;f++){var j,l;j=i[f][1];l=i[f][0];if(f>=b.options.thumbsQuantity){c.find(".vtex-cpViewMore").addClass("vtex-cpShow").removeClass("vtex-cpHide");
break}else""!=j&&(skuArrayLength>b.options.thumbsQuantity&&f>=b.options.thumbsQuantity-1||g.append(b.setThumbs(c,j,jQuery("<span class='vtex-cpSkuIds vtex-cpIndex_"+f+" vtex-cpSkuId_"+j+(0==f?" vtex-cpFirst":"")+"'><span class='vtex-cpInner'></span><span class='vtex-cpInner2'></span></span>"),l,a)))}})},groupSku:function(a,d){var c={},e={},h=[],g,f,i;i=a.length;if(2>i&&""==a[0])return h;for(var j=0;j<i;j++)g=a[j].split(";"),f=g.pop(),g=g.shift(),"undefined"!=typeof f&&("undefined"==typeof c[g]?c[g]=
[f]:c[g].push(f));for(ndx in c){i=c[ndx].length;f=[];if(3<i){g=parseInt(i/3);for(var l=i%3,k=2*g,j=0;j<g;j++)f.push(c[ndx][j]),f.push(c[ndx][j+g]),f.push(c[ndx][j+k]);1==l?f.push(c[ndx][i-1]):2==l&&(f.push(c[ndx][i-1]),f.push(c[ndx][i-2]))}else f=c[ndx];h.push([f.shift(),ndx]);e[ndx]=f}b.skuGroup[d]=e;return h},setThumbs:function(a,d,c,e,h){var g=a.find(".vtex-cpOverlay");c.addClass("vtex-cpLoadingData");b.loadSku(a,d,g,b.options.action,c,e,h);return c},checkIsAvaliable:function(a,d,c,e,h,g){if(e[0].Availability)b.mouseActions2(a,
d,c,e,h);else{var f=a.find(".vtex-cpOverlay");"undefined"!=typeof b.skuGroup[g][h]&&0<b.skuGroup[g][h].length?b.loadSku(a,b.skuGroup[g][h].shift(),f,b.options.action,c,h,g):b.mouseActions2(a,d,c,e,h)}},mouseActions2:function(a,d,c,e,h){b.setImgThumb(c,e);b.setClass(c,e);c.bind({mouseenter:function(){a.find(".vtex_cpActiveSku").removeClass("vtex_cpActiveSku");c.addClass("vtex_cpActiveSku");b.productOriginalInfo=a.find(".vtex-cpProductInfoWrap").children().clone();b.productOriginalLink=a.find(".vtex-cpProductLink:first").attr("href")||
"";var d=a.find(".vtex-cpSave");b.productOriginalSave=[d.html()||"",d.attr("class")||""];b.formatInfo(e,a,h);b.onHover=!0}});b.options.restoreOriginalDetails&&c.bind({mouseleave:function(){a.find(".vtex_cpActiveSku").removeClass("vtex_cpActiveSku");b.setOriginalElements(a);b.onHover=!1}});return c},mouseActions:function(a,d,c){c.bind({mouseenter:function(){a.find(".vtex_cpActiveSku").removeClass("vtex_cpActiveSku");c.addClass("vtex_cpActiveSku");var e=a.find(".vtex-cpOverlay").show();b.loadSku(a,
d,e);b.productOriginalInfo=a.find(".vtex-cpProductInfoWrap").children().clone();b.onHover=!0},mouseleave:function(){a.find(".vtex_cpActiveSku").removeClass("vtex_cpActiveSku");a.find(".vtex-cpOverlay").hide();b.loadSkuJqxhr.abort();b.setOriginalElements(a);b.onHover=!1}});return c},formatInfo:function(a,d,c){d.addClass("vtex-cpInfoFromSKU");var e=a[0];if(e.Availability||b.options.forceAvailable)if(a=d.find(".vtex-cpProductInfo"),a.addClass("vtex-cpShow").removeClass("vtex-cpHide"),d.find(".vtex-cpProductUnavailable").addClass("vtex-cpHide").removeClass("vtex-cpShow"),
a.find(".vtex-cpBestPrice").text(b.options.currency+b.numberFormat(e.Price)),d.find(".vtex-cpSave").html(b.options.saveText.replace("#value",b.numberFormat(e.ListPrice-e.Price))),e.Price<e.ListPrice?(a.find(".vtex-cpListPriceWrap").addClass("vtex-cpShow").removeClass("vtex-cpHide").find(".vtex-cpListPrice").text(b.options.currency+b.numberFormat(e.ListPrice)),d.find(".vtex-cpSave").addClass("vtex-cpShow").removeClass("vtex-cpHide")):(a.find(".vtex-cpListPriceWrap").addClass("vtex-cpHide").removeClass("vtex-cpShow"),
d.find(".vtex-cpSave").addClass("vtex-cpHide").removeClass("vtex-cpShow")),1<e.BestInstallmentNumber){var h=a.find(".vtex-cpInstallment").addClass("vtex-cpShow").removeClass("vtex-cpHide");h.find(".vtex-cpNumbersOfInstallment").text(e.BestInstallmentNumber);h.find(".vtex-cpInstallmentValue").text(b.options.currency+b.numberFormat(e.BestInstallmentValue));a.find(".vtex-cpFullRegularPrice").addClass("vtex-cpHide").removeClass("vtex-cpShow")}else a.find(".vtex-cpInstallment").addClass("vtex-cpHide").removeClass("vtex-cpShow"),
a.find(".vtex-cpFullRegularPrice").addClass("vtex-cpShow").removeClass("vtex-cpHide");else d.find(".vtex-cpProductInfo").addClass("vtex-cpHide").removeClass("vtex-cpShow"),d.find(".vtex-cpProductUnavailable").addClass("vtex-cpShow").removeClass("vtex-cpHide");var a=d.find(".vtex-cpProductImage"),g=d.find(".vtex-cpImgOverlay"),f=a.find(".vtex-cpOriginalImage"),i=f[0],j=f.clone(),h=j.attr("width")||i.naturalWidth,i=j.attr("height")||i.naturalHeight,e=b.getImageUrl(e,b.options.productImgId),j=d.find("img[src*='"+
(e[0]||f.attr("src"))+"']"),l=0<j.length?!0:!1,k=jQuery('<img src="'+(e[0]||f.attr("src"))+'" alt="" '+("undefined"!==typeof h?'width="'+h+'"':"")+" "+("undefined"!==typeof i?'height="'+i+'"':"")+' class="vtex-cpSkuImage" style="display:none;" />');""!=c&&d.find(".vtex-cpProductLink").attr("href",b.options.linkAdjust(c));g.show();l?(f.stop(!0).fadeOut(b.options.speedFade),g.hide(),d.find(".vtex-cpSkuImage").stop(!0).fadeOut(b.options.speedFade),j.stop(!0).fadeTo(b.options.speedFade,1)):(k.load(function(){b.onHover?
(f.stop(!0).fadeOut(b.options.speedFade),g.hide(),d.find(".vtex-cpSkuImage").stop(!0).fadeOut(b.options.speedFade),k.stop(!0).fadeTo(b.options.speedFade,1)):(g.hide(),b.setOriginalImg(d))}),a.append(k))},setOriginalElements:function(a){null!=b.productOriginalInfo&&a.hasClass("vtex-cpInfoFromSKU")&&(a.removeClass("vtex-cpInfoFromSKU").find(".vtex-cpProductInfoWrap").html(b.productOriginalInfo),b.setOriginalImg(a),b.setOriginalLink(a),b.setOriginalSaveText(a))},setOriginalImg:function(a){a=a.find(".vtex-cpProductImage");
a.find(":not(.vtex-cpOriginalImage)").stop(!0).fadeOut(b.options.speedFade);a.find(".vtex-cpOriginalImage").stop(!0).fadeTo(b.options.speedFade,1)},setOriginalLink:function(a){a.find(".vtex-cpProductLink").attr("href",b.productOriginalLink)},setOriginalSaveText:function(a){a.find(".vtex-cpSave").html(b.productOriginalSave[0]).attr("class",b.productOriginalSave[1])},setImgThumb:function(a,d){var c=b.getImageUrl(d[0],b.options.thumbImgId);a.removeClass("vtex-cpLoadingData");0<c.length&&(a.css("background-image",
"url('"+c[0]+"')"),a.find(".vtex-cpInner").append('<img src="'+c[0]+'" alt="" class="vtex-cpImgsThumb vtex-cpThumb_'+d[0].Id+'" alt=""/>'))},loadSku:function(a,d,c,e,h,g,f){var e=e||1,h=h||q,d=d.toString().trim(),i=d.toString();"undefined"!==typeof b.skuQueue[i]?b.skuQueue[i].push({liElem:a,skuId:d,span:h,link:g}):(b.skuQueue[i]=[],b.loadSkuJqxhr=jQuery.ajax({url:"/produto/sku/"+d,data:"json",success:function(c,l,k){if("object"!==typeof c)return n(b.options.messageRequestFail+"\n skuId: "+d+"\n(textStatus:'"+
l+"', jqXHR:'"+k+"')"),h.hide(),!1;if(0!=k.status){b.skuQueue[i].push({liElem:a,skuId:d,span:h,link:g});for(var l=b.skuQueue[i].length,k=b.skuQueue[i],m=0;m<l;m++)switch(e){case 1:b.formatInfo(c,k[m].liElem);break;case 2:b.checkIsAvaliable(k[m].liElem,k[m].skuId,k[m].span,c,k[m].link,f)}b.skuQueue[i]=void 0;b.options.ajaxCallback()}},error:function(a,c,e){n(b.options.messageRequestFail+"\n skuId: "+d+"\n(textStatus:'"+c+"', jqXHR:'"+a+"', errorThrown:'"+e+"')");h.hide()}}))},numberFormat:function(a){for(var b=
"",c=b="",a=a.toFixed(2).split("."),e=0,h=a[0].split("").length,g=a[0].length;0<g;g--)b=a[0].substr(g-1,1),e++,0==e%3&&h>e&&(b="."+b),c=b+c;return b=c+","+a[1]},getImageUrl:function(a,b){var c=[];if(1>a.Images.length)return n("N\u00e3o foram encontradas imagens para o SKU: "+a.Id),c;for(array in a.Images)for(img in a.Images[array])if(a.Images[array][img].ArchiveTypeId==b){c.push(a.Images[array][img].Path);break}return c},setClass:function(a,b){var c=b[0].Name.replace(/[^a-zA-Z0-9\-\_]/g,"");a.addClass("vtex-cp_"+
c)},shelfSetup:function(a){a.find("a[href='"+a.find(".vtex-cpUri").val()+"']").addClass("vtex-cpProductLink");var d=null;a.find("img").each(function(){var a=jQuery(this);d=null===d?a:d;if(0<(a.attr("width")||0))d=a});d.before('<div class="vtex-cpImgOverlay"></div>');d.parent().addClass("vtex-cpProductImage");var c=jQuery('<span class="vtex-cpProductTextWrap"><div class="vtex-cpOverlay"></div></span>'),e=jQuery('<span class="vtex-cpProductInfoWrap"></span>'),h=a.find(".vtex-cpProductInfo");h.before(c);
h.appendTo(e);a.find(".vtex-cpProductUnavailable").appendTo(e);e.appendTo(c);1>b.saveCount&&(c=/\sR\$\s[0-9]+,[0-9]{1,2}/i,a=a.find(".vtex-cpSave").text(),-1<a.search(c)&&(b.options.saveText=a.replace(c," R$ #value")),b.saveCount++)}};b.productShelf=jQuery(this);b.init(s);return b.productShelf};